<!DOCTYPE html>

<!--
  COLLABDESK PROTOTYPE:
  	Patricia Saylor
  	Divya Bajekal
  	Jonathan Lui
  	Benjamin Xie
  	
-->
<html>

<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<title>CollabDesk</title>

	<!-- Load style sheets -->
	<link rel="stylesheet" href="jquery-ui-1.10.2/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="bootstrap/css/bootstrap.css" />

	<!-- Load any supplemental Javascript libraries here -->
	<script type="text/javascript" src="jquery-ui-1.10.2/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="jquery-ui-1.10.2/ui/jquery-ui.js"></script>
	<script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
	<script src="http://www.parsecdn.com/js/parse-1.2.7.min.js"></script>

	<!-- Load our own Javascript files and stylesheets here -->
	<script type="text/javascript" src="backend.js"></script> 
	<!-- <script type="text/javascript" src="message.js"></script>
	<script type="text/javascript" src="database.js"></script> -->
	<script type="text/javascript" src="preloadData.js"></script>
	<script type="text/javascript" src="readMessage.js"></script>
	<script type="text/javascript" src="createMessage.js"></script>
	<script type="text/javascript" src="createReply.js"></script>
	<script type="text/javascript" src="templates.js"></script>
	<script type="text/javascript" src="search.js"></script>
	<script type="text/javascript" src="BrowsePane.js"></script>
	<script type="text/javascript" src="BrowsePaneListeners.js"></script>
	<script type="text/javascript" src="tooltip.js"></script>
	<link rel="stylesheet" href="styles.css" />

	<script type="text/javascript">

	// define global variables here
		var search = new Search();
		
    $(document).ready(function(){

	    /*
			LOAD THE DIFFERENT PANES FROM THEIR SEPARATE HTML PAGES
			the pane-inner div is loaded into its corresponding pane-wrapper div
		*/
			$('#reading-pane-wrapper').load("readPane.html #reading-pane-inner", function(responseTxt,statusTxt,xhr) {
				if (statusTxt =='success') {
					console.debug('external content loaded');
				} else if (statusTxt == 'error') {
					console.debug("Error: " + xhr.status + ": " + xhr.statusText);
				}

				readPaneReady();

			});
		

			$('#browse-pane-wrapper').load("browsePane.html #browse-pane-inner", function(responseTxt,statusTxt,xhr) {
				if (statusTxt =='success') {
					console.debug('external content loaded');
				} else if (statusTxt == 'error') {
					console.debug("Error: " + xhr.status + ": " + xhr.statusText);
				}

				browsePaneReady();
			});
		

			$('#create-pane-wrapper').load("createPane.html #create-pane-inner", function(responseTxt,statusTxt,xhr) {
				if (statusTxt =='success') {
					console.debug('external content loaded');
				} else if (statusTxt == 'error') {
					console.debug("Error: " + xhr.status + ": " + xhr.statusText);
				}

				createPaneReady();
			});

		//variables
		var browsePane;
		var newMessage = true;
		var replyId = 0;
		var popoverShowing=false;
		var searchTags=true;
		var searchTitles=true;
		var searchText=true;

		// view the preloaded database
		console.log(db);

		function readPaneReady() {
			console.debug('ready to work on read pane');
			// display a static message in the reading pane (until this is called from browsing pane)
	        displayMessage(3);

            /*Submits search to browse pane when a tag is clicked*/
            $(".tag").click(function() {
                var tagText = $(this).html();
                // tagText = tagText.substring(1, tagText.length);
                $('#search-tbox').val(tagText);
                browsePane.updateSearchedBrowsePane('message-table', db, search.getMessageIDs(tagText, db));
            });
		}		

		function createPaneReady() {
			console.debug('ready to work on create pane');

			$("#cancelBtn").click(function() {
	            newMessage = true;
	            reset();
	        });

	        $("#cancelBtn").click(function(e) {
	            if (e.which == 13) {
	                newMessage = true;
	                reset();
	            }
	        });

	        $("#selectTemplate").change(function() {
	            fillTemplate();
	        });

	        /*
	        Submits a reply when the reply button is clicked in the reading pane
	        */
	        $(".replyButton").click(function() {
	            newMessage = false;
	            openReplyForm();
	        });

	        /*
	        Submits the form when the user clicks the Submit button
	        */
	        $("#submitBtn").click(function() {
	            console.log(newMessage);
	            if (newMessage) {
	                submit();
	            } else {
	                submitReply(replyId);
	                displayMessage(replyId);
	            }
	            newMessage = true;
	            browsePane.updateBrowsePane("message-table",db);
	        });

	        /*
	        Submits the form when the user has focus on the Submit button and presses enter
	        */
	        $("#submitBtn").keydown(function (e) {
	                if (e.which == 13) {
	                    console.log($("#formTitle").html());
	                    if ($("#formTitle").html() == "Create New Message") {
	                    submit();
	                } else {
	                    submitReply(replyId);
	                    displayMessage(replyId);
	                }
	                newMessage = true;
	                browsePane.updateBrowsePane("message-table",db);

	            }
	        });
		}	
    });
	</script>

</head>

<body>

	<div class="loginHeader">
			<div class="floatLeft side">
				<h3 class="logo">CollabDesk</h3>
			</div>
			<div class="floatRight side">
				<div class="avatar side">
					<img class="avatar" src="images/generic_avatar.jpg"/>
				</div>
				<h3 class="side username">Sally</h3>
			</div>
			<div class="clear"></div>
	</div>

	<div class="container-fluid">

		<!-- browse pane -->
			<div class="browse floatLeftNoPadding left white" id="browse-pane-wrapper">
				<div id="browse-pane-inner">
					<div class="row-fluid">
						<div class="input-append span11	">
							<input type="text" class="input-block-level" id="search-tbox" autofocus />
							<span class="add-on btn"><i class="icon-search icon-color" id="search-button"></i></span>
						</div>
					</div>
					<div id="message-table">
						<!--MESSAGES DYNAMICALLY ADDED HERE-->
					</div>
				</div>
			</div>

		<!-- right side of layout: read and create -->		
		<div class="right">

		<!-- reading pane -->
            <div class="reading pane white" id="reading-pane-wrapper">
            	<div id="reading-pane-inner">
	                <div class="originalMsg">
	                    <div class="originalMsgHeader">
	                    	<div class="originalMsgTitle"></div>
							<div class="captain"><i class="icon-envelope icon-color"></i></div>
							<div class="high_pri"><i class="icon-exclamation-sign icon-color"></i></div>
							<div style="clear:right"></div>
	                    </div>
	                    <div class="originalMsgBody">
	                    	<div class="originalMsgDetails"></div>
	                    	<table>
	                    		<tr>
	                    			<td><div class="authorPic"><img class="authorPic" src="images/generic_avatar.jpg"/></div></td>
	                    			<td><div class="originalMsgDetailsText"></div></td>
	                    		</tr>
	                    	</table>
	                    	<div class="originalMsgText offset1"></div>
	                    </div>
	                </div>
	                <div class="replies"></div>
	                <div class="alignBottom parentWidth">
	                	<div class="hashtags"></div>
	                	<button type="button" class="replyButton btn btn-primary floatRight">Reply</button>
	                </div>
	            </div>
            </div>
        </div>

        <!-- gap between read and create panes -->
        <div class="gap"></div>


		<!-- create message pane -->
			<div class="create white" id="create-pane-wrapper">
			<div id="create-pane-inner">
			<form class="form">
			<fieldset>

			<!-- Form Name -->
			<legend id="formTitle">Create New Message
				<div class="floatRight btn"><i class="icon-chevron-down"></i></div>
			</legend>

			<!-- Select Template -->
				<div class="controls-row">
				<div class="control-group span5">
				  	<div class="controls">
				    <select id="selectTemplate" name="selectTemplate" class="input-xlarge">
				      	<option value="default">None Selected</option>
				      	<option value="missingPackage">Missing Package</option>
				      	<option value="lostKey">Lost Key</option>
				      	<option value="reOrder">Re-Order Supplies</option>
				      	<option value="foundPackage">Found Package</option>
				    </select>
				  	</div>
				</div>
			</div>

			<!-- Title -->
			<div class="controls-row">
				<div class="control-group span4">
				  	<div class="controls">
				    <input id="textinput" name="textinput" type="text" placeholder="Title" class="input-xlarge">
				    
				  	</div>
				</div>

			<!-- Multiple Checkboxes -->
				<div class="control-group span4">
				  	<div class="controls">
				  		<div class="btn-group" data-toggle="buttons-checkbox">
				  			<button type="button" class="btn" id="ni-btn">
				  				<div id="ni-note">
				  				<i class="icon-color icon-note"></i> Note
				  				</div>
				  				<div id="ni-issue" class="hide">
				  				<i class="icon-color icon-issue"></i> Issue
				  				</div>
				  			</button>
				  			<button type="button" class="btn" id="pri-btn"><i class="icon-exclamation-sign icon-color"></i> High Priority</button>
				  			<button type="button" class="btn" id="alert-btn"><i class="icon-envelope icon-color"></i> Alert Captain</button>
			  			</div>
				  </div>
				</div>
			</div>

			<!-- Message Text Area -->
				<div class="control-group controls-row">
					<div class="controls span8">                     
				    <textarea id="textarea" name="textarea" placeholder="Your message here..." class="input-block-level"></textarea>
				  	</div>
				</div>

			<!-- Tags -->
				<div class="control-group controls-row">
				  <div class="controls span8">
					<div class="input-prepend input-xlarge" id="tags-input">
				    	<span class="add-on" id="hashtag">#</span>
				    	<input id="prependedtext" name="prependedtext" class="" placeholder="#tags" type="text">
				    </div>
				    
				  </div>
				</div>

			<!-- Submit -->

				<div class="controls-row floatRight">
					<button type="button" id="submitBtn" class="btn btn-primary">Submit Message</button>
					<button type="button" id="cancelBtn" class="btn">Cancel</button>
				</div>
			</fieldset>
			</form>
		</div>
		</div>
			

</div>

</body>
</html>